(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{2270:(e,t,s)=>{"use strict";var n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,l=(e,t,s)=>new Promise((n,r)=>{var o=e=>{try{l(s.next(e))}catch(e){r(e)}},a=e=>{try{l(s.throw(e))}catch(e){r(e)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,a);l((s=s.apply(e,t)).next())}),i={};((e,t)=>{for(var s in t)n(e,s,{get:t[s],enumerable:!0})})(i,{SessionContextProvider:()=>u,useSession:()=>p,useSessionContext:()=>m,useSupabaseClient:()=>h,useUser:()=>g}),e.exports=((e,t,s,l)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of o(t))a.call(e,s)||void 0===s||n(e,s,{get:()=>t[s],enumerable:!(l=r(t,s))||l.enumerable});return e})(n({},"__esModule",{value:!0}),i);var c=s(2115),d=s(5155),x=(0,c.createContext)({isLoading:!0,session:null,error:null,supabaseClient:{}}),u=({supabaseClient:e,initialSession:t=null,children:s})=>{let[n,r]=(0,c.useState)(t),[o,a]=(0,c.useState)(!t),[i,u]=(0,c.useState)();(0,c.useEffect)(()=>{!n&&t&&r(t)},[n,t]),(0,c.useEffect)(()=>{let t=!0;return!function(){l(this,null,function*(){let{data:{session:s},error:n}=yield e.auth.getSession();if(t){if(n){u(n),a(!1);return}r(s),a(!1)}})}(),()=>{t=!1}},[]),(0,c.useEffect)(()=>{let{data:{subscription:t}}=e.auth.onAuthStateChange((e,t)=>{t&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e||"USER_UPDATED"===e)&&r(t),"SIGNED_OUT"===e&&r(null)});return()=>{t.unsubscribe()}},[]);let m=(0,c.useMemo)(()=>o?{isLoading:!0,session:null,error:null,supabaseClient:e}:i?{isLoading:!1,session:null,error:i,supabaseClient:e}:{isLoading:!1,session:n,error:null,supabaseClient:e},[o,n,i]);return(0,d.jsx)(x.Provider,{value:m,children:s})},m=()=>{let e=(0,c.useContext)(x);if(void 0===e)throw Error("useSessionContext must be used within a SessionContextProvider.");return e};function h(){let e=(0,c.useContext)(x);if(void 0===e)throw Error("useSupabaseClient must be used within a SessionContextProvider.");return e.supabaseClient}var p=()=>{let e=(0,c.useContext)(x);if(void 0===e)throw Error("useSession must be used within a SessionContextProvider.");return e.session},g=()=>{var e,t;let s=(0,c.useContext)(x);if(void 0===s)throw Error("useUser must be used within a SessionContextProvider.");return null!=(t=null==(e=s.session)?void 0:e.user)?t:null}},4366:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var n=s(5155),r=s(2115),o=s(6874),a=s.n(o),l=s(6766),i=s(9911),c=s(5695);function d(){let[e,t]=(0,r.useState)(!1),s=(0,c.usePathname)();return(0,n.jsxs)("nav",{className:"fixed w-full z-50 bg-stone-50/60 dark:bg-stone-900/70 backdrop-blur-sm border-b border-stone-200/50 dark:border-stone-700/80",children:[(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(a(),{href:"/",className:"flex items-center",children:(0,n.jsx)(l.default,{src:"/images/nav-logo.png",alt:"Courtown BMX",width:2e3,height:2e3,className:"h-12 w-auto",priority:!0})})}),(0,n.jsx)("div",{className:"hidden lg:block",children:(0,n.jsxs)("div",{className:"ml-10 flex items-center space-x-4",children:[(0,n.jsx)(a(),{href:"/",className:"px-3 py-2 transition-colors font-semibold ".concat("/"===s?"text-yellow-400":"text-stone-900 dark:text-stone-200 hover:text-yellow-400"),children:"Home"}),(0,n.jsx)(a(),{href:"/events",className:"px-3 py-2 transition-colors font-semibold ".concat("/events"===s?"text-yellow-400":"text-stone-900 dark:text-stone-200 hover:text-yellow-400"),children:"Events"}),(0,n.jsx)(a(),{href:"/membership",className:"px-3 py-2 transition-colors font-semibold ".concat("/membership"===s?"text-yellow-400":"text-stone-900 dark:text-stone-200 hover:text-yellow-400"),children:"Membership"}),(0,n.jsx)(a(),{href:"/information",className:"px-3 py-2 transition-colors font-semibold ".concat("/information"===s?"text-yellow-400":"text-stone-900 dark:text-stone-200 hover:text-yellow-400"),children:"Information"})]})}),(0,n.jsxs)("div",{className:"hidden lg:flex items-center space-x-4",children:[(0,n.jsx)(a(),{href:"https://www.instagram.com/courtownbmx/",target:"_blank",className:"text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",children:(0,n.jsx)(i.ao$,{className:"h-5 w-5"})}),(0,n.jsx)(a(),{href:"https://www.facebook.com/people/Courtown-BMX/61559028380966/",target:"_blank",className:"text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",children:(0,n.jsx)(i.iYk,{className:"h-5 w-5"})}),(0,n.jsx)(a(),{href:"https://chat.whatsapp.com/I28VDPqtCbbIId4dubFHzK",target:"_blank",className:"text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",children:(0,n.jsx)(i.EcP,{className:"h-5 w-5"})}),(0,n.jsx)(a(),{href:"/information",className:"bg-purple-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-purple-700 transition-colors",children:"Contact"})]}),(0,n.jsxs)("button",{onClick:()=>t(!e),className:"lg:hidden p-2 rounded-md text-stone-900 dark:text-stone-200 hover:bg-stone-200/50 dark:hover:bg-stone-900/50 transition-colors",children:[(0,n.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,n.jsxs)("div",{className:"w-6 h-5 relative flex items-center justify-center",children:[(0,n.jsx)("span",{className:"absolute h-0.5 bg-current transform transition-all duration-300 ".concat(e?"w-7 rotate-45":"w-6 -translate-y-2")}),(0,n.jsx)("span",{className:"absolute h-0.5 w-6 bg-current transition-all duration-300 ".concat(e?"opacity-0":"")}),(0,n.jsx)("span",{className:"absolute h-0.5 bg-current transform transition-all duration-300 ".concat(e?"w-7 -rotate-45":"w-6 translate-y-2")})]})]})]})}),(0,n.jsxs)("div",{className:"lg:hidden absolute top-16 inset-x-0 bg-stone-50/55 dark:bg-stone-900/85 backdrop-blur-sm transition-all duration-300 ease-in-out ".concat(e?"opacity-100 translate-y-0":"opacity-0 -translate-y-2 pointer-events-none"),children:[(0,n.jsxs)("div",{className:"px-4 pt-2 pb-4 space-y-1",children:[(0,n.jsx)(a(),{href:"/",className:"block px-3 py-2 text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:"Home"}),(0,n.jsx)(a(),{href:"/events",className:"block px-3 py-2 text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:"Events"}),(0,n.jsx)(a(),{href:"/membership",className:"block px-3 py-2 text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:"Membership"}),(0,n.jsx)(a(),{href:"/information",className:"block px-3 py-2 text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:"Information"})]}),(0,n.jsxs)("div",{className:"px-4 py-4 border-t border-stone-200/50 dark:border-stone-700/50",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,n.jsx)(a(),{href:"https://instagram.com",target:"_blank",className:"text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:(0,n.jsx)(i.ao$,{className:"h-5 w-5"})}),(0,n.jsx)(a(),{href:"https://facebook.com",target:"_blank",className:"text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:(0,n.jsx)(i.iYk,{className:"h-5 w-5"})}),(0,n.jsx)(a(),{href:"https://whatsapp.com",target:"_blank",className:"text-stone-900 dark:text-stone-200 hover:text-yellow-400 transition-colors",onClick:()=>t(!1),children:(0,n.jsx)(i.EcP,{className:"h-5 w-5"})})]}),(0,n.jsx)(a(),{href:"/contact",className:"block w-full bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors text-center",onClick:()=>t(!1),children:"Contact"})]})]})]})}},4879:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var n=s(5155),r=s(2115),o=s(5695),a=s(2270),l=s(4366);function i(){let e=(0,a.useSupabaseClient)(),t=(0,a.useUser)(),s=(0,o.useRouter)(),[i,c]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)(new Date().toISOString().split("T")[0]),[b,w]=(0,r.useState)("day"),[k,y]=(0,r.useState)("today"),N=(0,r.useCallback)(async t=>{x(!0),m(null);try{let{data:s,error:n}=await e.from("log_entries").select("*").gte("created_at","".concat(t,"T00:00:00.000Z")).lte("created_at","".concat(t,"T23:59:59.999Z")).order("created_at",{ascending:!1});n?(console.error("Error fetching logs:",n),m("Failed to fetch logs: ".concat(n.message))):c(s||[])}catch(t){let e=t instanceof Error?t.message:"An unknown error occurred";m("An unexpected error occurred: ".concat(e))}finally{x(!1)}},[e]),j=(0,r.useCallback)(async t=>{x(!0),m(null);try{let s=new Date(t),n=new Date(t);n.setDate(s.getDate()+6);let{data:r,error:o}=await e.from("log_entries").select("*").gte("created_at","".concat(s.toISOString().split("T")[0],"T00:00:00.000Z")).lte("created_at","".concat(n.toISOString().split("T")[0],"T23:59:59.999Z")).order("created_at",{ascending:!1});o?(console.error("Error fetching logs:",o),m("Failed to fetch logs: ".concat(o.message))):c(r||[])}catch(t){let e=t instanceof Error?t.message:"An unknown error occurred";m("An unexpected error occurred: ".concat(e))}finally{x(!1)}},[e]);(0,r.useEffect)(()=>{!async function(){if(!t)return s.push("/login");let{data:n,error:r}=await e.from("profiles").select("role").eq("id",t.id).single();if(r){console.error("Error fetching user profile for admin check:",r),m("Authorization check failed: ".concat(r.message||"Could not retrieve user profile or role.")),x(!1),s.push("/login?message=Not authorized");return}if(!n||"admin"!==n.role){console.warn("Authorization check failed: Profile data inconsistent or user is not an admin.",{userId:t.id,profileData:n}),m("You do not have administrative access. Please log in with an admin account."),x(!1),s.push("/login?message=Not authorized");return}p(!0),await N(g)}()},[t,s,e,g,N]);let v=async()=>{x(!0);let{error:t}=await e.auth.signOut();t?(m("Error logging out: ".concat(t.message)),x(!1)):s.push("/login")},S=(e,t)=>{if("week"===t){let e=new Date,t=e.getDay(),s=new Date(e);s.setDate(e.getDate()+(0===t?-6:1-t));let n=s.toISOString().split("T")[0];f(n),w("week"),y("week"),j(n)}else{let s=new Date;s.setDate(s.getDate()+e);let n=s.toISOString().split("T")[0];f(n),w("day"),y(t),N(n)}},C=e=>{f(e),w("day"),y("custom"),N(e)};return d?(0,n.jsxs)("main",{className:"min-h-screen bg-stone-50 text-stone-900 dark:bg-stone-900 dark:text-stone-50",children:[(0,n.jsx)(l.default,{}),(0,n.jsx)("div",{className:"pt-24 pb-12 flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-stone-600 dark:text-stone-400",children:"Loading dashboard..."})]})})]}):u?(0,n.jsxs)("main",{className:"min-h-screen bg-stone-50 text-stone-900 dark:bg-stone-900 dark:text-stone-50",children:[(0,n.jsx)(l.default,{}),(0,n.jsx)("div",{className:"pt-24 pb-12 flex items-center justify-center min-h-screen px-4",children:(0,n.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-8 max-w-md w-full text-center",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-red-800 dark:text-red-200 mb-4",children:"Error"}),(0,n.jsx)("p",{className:"text-red-700 dark:text-red-300",children:u})]})})]}):t&&h?(0,n.jsxs)("main",{className:"min-h-screen bg-stone-50 text-stone-900 dark:bg-stone-900 dark:text-stone-50",children:[(0,n.jsx)(l.default,{}),(0,n.jsxs)("div",{className:"pt-24 pb-12",children:[(0,n.jsx)("h1",{className:"text-5xl font-bold text-center",children:"Admin Dashboard"}),(0,n.jsx)("p",{className:"text-center text-stone-600 dark:text-stone-400 mt-4 text-lg",children:"Track visitor log entries and manage access"})]}),(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16",children:[(0,n.jsx)("div",{className:"bg-white dark:bg-stone-800 rounded-xl shadow-lg border border-stone-200/50 dark:border-stone-700/80 p-6 mb-8",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-stone-800 dark:text-stone-100",children:"Filter by Date"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)("button",{onClick:()=>S(0,"today"),className:"font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 dark:focus:ring-offset-stone-800 ".concat("today"===k?"bg-purple-600 hover:bg-purple-700 text-white":"bg-stone-600 hover:bg-stone-700 text-white"),children:"Today"}),(0,n.jsx)("button",{onClick:()=>S(-1,"yesterday"),className:"font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 dark:focus:ring-offset-stone-800 ".concat("yesterday"===k?"bg-purple-600 hover:bg-purple-700 text-white":"bg-stone-600 hover:bg-stone-700 text-white"),children:"Yesterday"}),(0,n.jsx)("button",{onClick:()=>S(0,"week"),className:"font-medium py-2 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 dark:focus:ring-offset-stone-800 ".concat("week"===k?"bg-purple-600 hover:bg-purple-700 text-white":"bg-stone-600 hover:bg-stone-700 text-white"),children:"Week View"})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[(0,n.jsx)("label",{htmlFor:"filterDate",className:"text-base font-medium text-stone-700 dark:text-stone-300",children:"Or select custom date:"}),(0,n.jsx)("input",{type:"date",id:"filterDate",value:g,onChange:e=>{C(e.target.value)},className:"px-4 py-2 rounded-lg border border-stone-300 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 text-stone-900 dark:text-stone-50 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400 transition"})]}),(0,n.jsx)("div",{className:"text-sm text-stone-600 dark:text-stone-400",children:(()=>{if("week"!==b)return"Showing ".concat(i.length," entries for ").concat(new Date(g).toLocaleDateString("en-IE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));{let e=new Date(g),t=new Date(g);return t.setDate(e.getDate()+6),"Showing ".concat(i.length," entries for week of ").concat(e.toLocaleDateString("en-IE",{day:"numeric",month:"short"})," - ").concat(t.toLocaleDateString("en-IE",{day:"numeric",month:"short",year:"numeric"}))}})()})]})}),(0,n.jsx)("div",{className:"bg-white dark:bg-stone-800 rounded-xl shadow-lg border border-stone-200/50 dark:border-stone-700/80 overflow-hidden",children:0===i.length?(0,n.jsxs)("div",{className:"p-12 text-center",children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("svg",{className:"mx-auto h-12 w-12 text-stone-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,n.jsx)("h3",{className:"text-lg font-medium text-stone-900 dark:text-stone-100 mb-2",children:"No entries found"}),(0,n.jsx)("p",{className:"text-stone-600 dark:text-stone-400",children:"week"===b?"No rider sign-ins for the selected week.":"No rider sign-ins for ".concat(new Date(g).toLocaleDateString(),".")})]}):(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-stone-200 dark:divide-stone-700",children:[(0,n.jsx)("thead",{className:"bg-stone-50 dark:bg-stone-900",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"week"===b?"Date & Time":"Time"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"Rider Name"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"Emergency Contact"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"Club"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"Type"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"Payment Method"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"License No."})]})}),(0,n.jsx)("tbody",{className:"bg-white dark:bg-stone-800 divide-y divide-stone-200 dark:divide-stone-700",children:i.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors duration-150",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-stone-900 dark:text-stone-100",children:"week"===b?new Date(e.created_at).toLocaleDateString("en-IE",{weekday:"short",month:"short",day:"numeric"})+" "+new Date(e.created_at).toLocaleTimeString():new Date(e.created_at).toLocaleTimeString()}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("div",{className:"text-sm font-medium text-stone-900 dark:text-stone-100",children:e.name})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-stone-900 dark:text-stone-100",children:e.phone_number}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-stone-900 dark:text-stone-100",children:e.club_affiliation}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("member"===e.membership_type?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"),children:e.membership_type})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("member"===e.payment_method?"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300":"cash"===e.payment_method?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300"),children:e.payment_method||"N/A"})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-stone-900 dark:text-stone-100",children:e.license_number||"N/A"})]},e.id))})]})})}),(0,n.jsx)("div",{className:"mt-12 text-center",children:(0,n.jsx)("button",{onClick:v,className:"bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2 dark:focus:ring-offset-stone-800 shadow-lg",children:"Sign Out"})})]})]}):null}},5022:(e,t,s)=>{Promise.resolve().then(s.bind(s,4879))}},e=>{var t=t=>e(e.s=t);e.O(0,[711,960,441,684,358],()=>t(5022)),_N_E=e.O()}]);